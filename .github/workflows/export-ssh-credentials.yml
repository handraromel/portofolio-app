name: Export SSH Credentials (DELETE AFTER USE)

# WARNING: This workflow exposes sensitive credentials
# Only run this manually when needed, download the artifact, then DELETE this file

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  export-secrets:
    runs-on: ubuntu-latest
    
    steps:
      - name: Create credentials directory
        run: mkdir -p ssh-credentials
      
      - name: Export SSH credentials to files
        run: |
          echo "${{ secrets.HOST }}" > ssh-credentials/host.txt
          echo "${{ secrets.USERNAME }}" > ssh-credentials/username.txt
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ssh-credentials/ssh_key.pem
          echo "${{ secrets.SSH_PASSPHRASE }}" > ssh-credentials/passphrase.txt
          
          # Set proper permissions for SSH key
          chmod 600 ssh-credentials/ssh_key.pem
          
          # Create a README with instructions
          cat << 'EOF' > ssh-credentials/README.txt
          SSH Credentials Export
          =====================
          
          Files in this archive:
          - host.txt: Server hostname/IP
          - username.txt: SSH username
          - ssh_key.pem: Private SSH key (keep this secure!)
          - passphrase.txt: SSH key passphrase
          
          Usage:
          1. Extract this archive to a secure location
          2. Set proper permissions: chmod 600 ssh_key.pem
          3. Use the credentials as needed
          4. DELETE these files when done
          5. DELETE the export-ssh-credentials.yml workflow file from your repo
          
          To connect to your server:
          ssh -i ssh_key.pem $(cat username.txt)@$(cat host.txt)
          
          IMPORTANT: Keep these files secure and delete them when no longer needed!
          EOF
          
          echo "✓ Credentials exported successfully"
          ls -lh ssh-credentials/
      
      - name: Upload credentials as artifact
        uses: actions/upload-artifact@v4
        with:
          name: ssh-credentials
          path: ssh-credentials/
          retention-days: 1  # Artifact expires after 1 day
          
      - name: Security reminder
        run: |
          echo "================================================"
          echo "⚠️  SECURITY REMINDER"
          echo "================================================"
          echo "1. Download the artifact immediately"
          echo "2. Store it securely on your local machine"
          echo "3. DELETE this workflow file after use"
          echo "4. Consider rotating these credentials after export"
          echo "================================================"
